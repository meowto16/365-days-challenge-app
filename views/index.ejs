<!DOCTYPE html>
<html lang="en">
<head>
  <title>365 days challenge</title>
  <link rel='stylesheet' href='/css/style.css'/>
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
<header class="header header--elevated">
  <div class="header__content">
    <div class="container">
      <div class="header__inner">
        <div class="header__logo">
          <div class="logo">
            <span class="logo__icon">
              <svg class="svg-fit">
                <use xlink:href="/svg/sprite.svg#logo"></use>
              </svg>
            </span>
            <h1 class="logo__text">365 days challenge</h1>
          </div>
        </div>
        <div class="header__date">
          <% if (typeof time !== 'undefined') { %>
            <time class="header__time" datetime="<%= time.datetime %>" datatype="<%= time.datatype %>">
              <%= time.humantime %>
            </time>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</header>
<main class="main">
  <div class="container">
    <% if (typeof challengers !== 'undefined' && !!challengers?.length) { %>
      <section class="challengers" id="challengers">
        <h2 class="challengers__title">Challengers</h2>
        <div class="challengers__container">
          <% challengers.map(challenger => { %>
            <div class="challenger__card">
              <div class="card">
                <div class="card__left">
                  <div class="card__info">
                    <% if (typeof challenger.info.avatar !== 'undefined') { %>
                      <div class="card__avatar">
                          <img class="card__avatar-img"
                               width="100"
                               height="100"
                               src="<%= challenger.info.avatar %>"
                               alt="<%= challenger.info.name %>"/>
                          <% if (typeof challenger.secretAchievements.some(achievement => achievement.completed)) { %>
                          <ul class="secret-achievements">
                              <% if (challenger.secretAchievements.find(ach => ach.code === 'takes-it-easy' && ach.completed)) { %>
                              <li class="secret-achievements__item"
                                  data-popper
                                  data-popper-title="На расслабоне"
                                  data-popper-description="
                                    За неделю 7 контрибьютов...
                                    <img class='secret-achievements__full-img' src='/images/memes/1-takes-it-easy@full.png'>
                                    Лишь бы не проиграть пиццу? Не позорься и <b>купи всем пиццы</b>">
                                  <img class="secret-achievements__img" src="/images/memes/1-takes-it-easy.png" width="20" height="20" />
                              </li>
                              <% } %>
                          </ul>
                          <% } %>
                      </div>
                    <% } %>
                    <% if (typeof challenger.info.name !== 'undefined') { %>
                      <p class="card__name"><%= challenger.info.name %></p>
                    <% } %>
                    <% if (typeof challenger.info.specialization !== 'undefined') { %>
                      <span class="card__technology">
                  <svg class="svg-fit">
                    <use xlink:href="<%= challenger.info.specialization %>"></use>
                  </svg>
                </span>
                    <% } %>
                  </div>
                  <% if (typeof challenger.stats !== 'undefined') { %>
                    <div class="card__stats">
                      <p class="card__title">Current stats</p>
                      <ul class="card__statistic">
                        <% if (typeof challenger.stats.currentStreak === 'string') { %>
                          <li><strong>Current streak: </strong><%= challenger.stats.currentStreak %></li>
                        <% } %>
                        <% if (typeof challenger.stats.contributionsPerDay === 'string') { %>
                          <li><strong>Contributions per day: </strong><%= challenger.stats.contributionsPerDay %></li>
                        <% } %>
                        <% if (typeof challenger.stats.totalContributes === 'string') { %>
                            <li><strong>Total contributes: </strong><%= challenger.stats.totalContributes %></li>
                        <% } %>
                        <% if (typeof challenger.stats.lastActive === 'string') { %>
                          <li><strong>Last active: </strong><%= challenger.stats.lastActive %></li>
                        <% } %>
                        <% if (typeof challenger.stats.daysMissed === 'string') { %>
                          <li><strong>Days missed: </strong><%= challenger.stats.daysMissed %></li>
                        <% } %>
                      </ul>
                    </div>
                  <% } %>

                  <% if (typeof challenger.achievements !== 'undefined' && !!challenger.achievements?.length) { %>
                    <div class="card__achievements">
                      <p class="card__title">Achievements</p>
                      <div class="achievements">
                        <ul class="achievements__list">
                          <% challenger.achievements.map(achievement => { %>
                            <li class="achievements__item <%= achievement.completed ? 'achievements__item--completed' : 'achievements__item--default' %>"
                                data-popper
                                data-popper-title="<%= achievement.completed ? '✔ ' : ''%><%= achievement.name %>"
                                data-popper-description="<%= achievement.description %>">
                                <svg width="40" height="40" class="achievements__progress achievements__progress--bg" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="20" cy="20" r="18" stroke-dasharray="113" stroke-dashoffset="0" />
                                </svg>
                                <svg width="40" height="40" class="achievements__progress" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="20" cy="20" r="18" stroke-dasharray="113" stroke-dashoffset="<%= 100 - achievement.progress%>" />
                                </svg>
                                <svg width="40" height="40" class="achievements__progress achievements__progress--overlay" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="20" cy="20" r="18" stroke-dasharray="113" stroke-dashoffset="0" />
                                </svg>
                                <span class="achievements__icon">
                                    <svg class="svg-fit" width="20" height="20">
                                        <use xlink:href="<%= achievement.icon %>"></use>
                                    </svg>
                                </span>
                            </li>
                          <% }) %>
                        </ul>
                      </div>
                    </div>
                  <% } %>

                  <% if (typeof challenger.info.socials !== 'undefined') { %>
                    <div class="card__socials">
                      <ul class="socials">
                        <% Object.keys(challenger.info.socials).map(key => { %>
                          <li class="socials__item">
                            <a class="socials__icon" href="<%= challenger.info.socials[key] %>" target="_blank">
                              <svg class="svg-fit">
                                <use xlink:href="/svg/sprite.svg#<%= key %>"></use>
                              </svg>
                            </a>
                          </li>
                        <% }) %>
                      </ul>
                    </div>
                  <% } %>
                </div>
                <div class="card__right">

                  <div class="card__rating">
                      <% if (typeof challenger.rating === 'number') { %>
                    <div>
                        <ul class="rating"
                            data-popper
                            data-popper-title="User rating"
                            data-popper-description="
                                Every day matter. Calculates from last 7 days average efficiency (contributes in a week).
                                <br>
                                <br>★ 1 - 8 contributes
                                <br>★ 2 - 16 contributes
                                <br>★ 3 - 24 contributes
                                <br>★ 4 - 32 contributes
                                <br>★ 5 - 40 contributes
                            ">
                          <% for (let i = 1; i <= 5; i++) { %>
                            <li class="rating__star rating__star--<%= i <= challenger.rating ? 'filled' : 'default' %>">
                              <svg class="svg-fit">
                                <use xlink:href="/svg/sprite.svg#star"></use>
                              </svg>
                            </li>
                          <% } %>
                        </ul>
                    </div>
                          <% } %>
                    <p class="card__title">Last week activity</p>
                  </div>

                  <% if (typeof challenger.activity !== 'undefined') { %>
                  <div class="card__activity">
                    <ul class="activity">
                      <% Object.keys(challenger.activity).map(day => { %>
                        <li class="activity__item"
                            data-popper
                            data-popper-title="<%= challenger.activity[day].date %>"
                            data-popper-description="<%= challenger.activity[day].contributes %>"
                        >
                          <span class="activity__title"><%= day %></span>
                          <span class="<%= (() => {
                            const classes = ['activity__scale']
                            const activity = challenger.activity[day].activity
                            if (activity <= 2 && activity > 0) classes.push('activity__scale--warning')
                            if (activity === 0) classes.push('activity__scale--danger')
                            return classes.join(' ')
                          })() %>">
                            <% for (let i = 6; i >= 1; i--) { %>
                              <span class="activity__scale-part activity__scale-part--<%= i <= challenger.activity[day].activity ? 'filled' : 'empty' %>"></span>
                            <% } %>
                          </span>
                        </li>
                      <% }) %>
                    </ul>
                  </div>
                  <% } %>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      </section>
    <% } %>
  </div>
</main>
<footer class="footer footer--black">
  <div class="copyright">
    <div class="container">
      <div class="copyright__inner">
          <span class="copyright__icon">
            <svg class="svg-fit" width="24" height="24">
              <use xlink:href="/svg/sprite.svg#cards"></use>
            </svg>
        </span>
        <span class="copyright__title">Made with skill. 2022</span>
      </div>
    </div>
  </div>
</footer>
<div class="tooltip tooltip--hidden" role="tooltip">
    <span class="tooltip__title js-tooltip-title">God</span>
    <span class="tooltip__description js-tooltip-description">15 contributions</span>
    <div id="arrow" data-popper-arrow></div>
</div>
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="/js/script.js"></script>
</body>
</html>
